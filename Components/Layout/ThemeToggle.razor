@rendermode InteractiveServer
@using Microsoft.JSInterop
@inject IJSRuntime JSRuntime

<div class="theme-toggle">
    <button class="btn btn-sm @ThemeButtonClass" @onclick="ToggleTheme" title="@ThemeTitle">
        @if (IsDarkMode)
        {
            <span>üåô Dark</span>
        }
        else
        {
            <span>‚òÄÔ∏è Light</span>
        }
    </button>
</div>

@code {
    private bool IsDarkMode { get; set; } = false;
    private string ThemeButtonClass => IsDarkMode ? "btn-light" : "btn-dark";
    private string ThemeTitle => IsDarkMode ? "Zu hellem Modus wechseln" : "Zu dunklem Modus wechseln";

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Lade das gespeicherte Theme aus dem LocalStorage
            try
            {
                var theme = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "theme");
                IsDarkMode = theme == "dark";
                await ApplyTheme();
                StateHasChanged();
            }
            catch
            {
                // Falls LocalStorage nicht verf√ºgbar ist, verwende helles Theme
                IsDarkMode = false;
            }
        }
    }

    private async Task ToggleTheme()
    {
        // Theme umschalten
        IsDarkMode = !IsDarkMode;
        // Theme anwenden
        await ApplyTheme();
        // Im LocalStorage speichern
        await SaveThemePreference();
    }

    private async Task ApplyTheme()
    {
        try
        {
            // Setze das data-theme Attribut auf dem html Element
            var theme = IsDarkMode ? "dark" : "light";
            await JSRuntime.InvokeVoidAsync("eval", $"document.documentElement.setAttribute('data-theme', '{theme}')");
        }
        catch
        {
            // Fehler beim Anwenden des Themes ignorieren
        }
    }

    private async Task SaveThemePreference()
    {
        try
        {
            // Speichere die Auswahl im LocalStorage f√ºr sp√§tere Besuche
            var theme = IsDarkMode ? "dark" : "light";
            await JSRuntime.InvokeVoidAsync("localStorage.setItem", "theme", theme);
        }
        catch
        {
            // Fehler beim Speichern ignorieren
        }
    }
}

<style>
    .theme-toggle {
        display: inline-block;
    }

    .theme-toggle .btn {
        border-radius: 20px;
        padding: 0.25rem 0.75rem;
        font-size: 0.875rem;
        transition: all 0.3s ease;
    }

    .theme-toggle .btn:hover {
        transform: scale(1.05);
    }
</style>
